
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://fedderw.github.io/prefect-transitscope-baltimore-pipeline/tasks/">
      
      
        <link rel="prev" href="../examples_catalog/">
      
      
        <link rel="next" href="../flows/">
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>Tasks - prefect-transitscope-baltimore-pipeline</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Source Code Pro"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prefect_transitscope_baltimore_pipeline.tasks" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="prefect-transitscope-baltimore-pipeline" class="md-header__button md-logo" aria-label="prefect-transitscope-baltimore-pipeline" data-md-component="logo">
      
  <img src="../img/prefect-logo-mark-solid-white-500.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            prefect-transitscope-baltimore-pipeline
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tasks
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/fedderw/prefect-transitscope-baltimore-pipeline" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="prefect-transitscope-baltimore-pipeline" class="md-nav__button md-logo" aria-label="prefect-transitscope-baltimore-pipeline" data-md-component="logo">
      
  <img src="../img/prefect-logo-mark-solid-white-500.png" alt="logo">

    </a>
    prefect-transitscope-baltimore-pipeline
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/fedderw/prefect-transitscope-baltimore-pipeline" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../blocks_catalog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blocks Catalog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples_catalog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples Catalog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Tasks
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Tasks
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.calculate_days_and_daily_ridership" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_days_and_daily_ridership
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.calculate_days_in_month" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_days_in_month
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.convert_date_and_calculate_end_of_month" class="md-nav__link">
    <span class="md-ellipsis">
      convert_date_and_calculate_end_of_month
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.download_mta_bus_stops" class="md-nav__link">
    <span class="md-ellipsis">
      download_mta_bus_stops
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.exclude_zero_ridership" class="md-nav__link">
    <span class="md-ellipsis">
      exclude_zero_ridership
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.format_bus_routes" class="md-nav__link">
    <span class="md-ellipsis">
      format_bus_routes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.format_bus_routes_task" class="md-nav__link">
    <span class="md-ellipsis">
      format_bus_routes_task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.map_color_to_citylink" class="md-nav__link">
    <span class="md-ellipsis">
      map_color_to_citylink
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.scrape" class="md-nav__link">
    <span class="md-ellipsis">
      scrape
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.standardize_column_names" class="md-nav__link">
    <span class="md-ellipsis">
      standardize_column_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.standardize_column_names_task" class="md-nav__link">
    <span class="md-ellipsis">
      standardize_column_names_task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.transform_mta_bus_stops" class="md-nav__link">
    <span class="md-ellipsis">
      transform_mta_bus_stops
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flows
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.calculate_days_and_daily_ridership" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_days_and_daily_ridership
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.calculate_days_in_month" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_days_in_month
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.convert_date_and_calculate_end_of_month" class="md-nav__link">
    <span class="md-ellipsis">
      convert_date_and_calculate_end_of_month
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.download_mta_bus_stops" class="md-nav__link">
    <span class="md-ellipsis">
      download_mta_bus_stops
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.exclude_zero_ridership" class="md-nav__link">
    <span class="md-ellipsis">
      exclude_zero_ridership
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.format_bus_routes" class="md-nav__link">
    <span class="md-ellipsis">
      format_bus_routes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.format_bus_routes_task" class="md-nav__link">
    <span class="md-ellipsis">
      format_bus_routes_task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.map_color_to_citylink" class="md-nav__link">
    <span class="md-ellipsis">
      map_color_to_citylink
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.scrape" class="md-nav__link">
    <span class="md-ellipsis">
      scrape
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.standardize_column_names" class="md-nav__link">
    <span class="md-ellipsis">
      standardize_column_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.standardize_column_names_task" class="md-nav__link">
    <span class="md-ellipsis">
      standardize_column_names_task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_transitscope_baltimore_pipeline.tasks.transform_mta_bus_stops" class="md-nav__link">
    <span class="md-ellipsis">
      transform_mta_bus_stops
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<div class="doc doc-object doc-module">



<h1 id="prefect_transitscope_baltimore_pipeline.tasks" class="doc doc-heading">
          <code>prefect_transitscope_baltimore_pipeline.tasks</code>


</h1>

  <div class="doc doc-contents first">
  
      <p>This is an example tasks module</p>

  

  <div class="doc doc-children">







<h2 id="prefect_transitscope_baltimore_pipeline.tasks-functions">Functions</h2>


<div class="doc doc-object doc-function">



<h3 id="prefect_transitscope_baltimore_pipeline.tasks.calculate_days_and_daily_ridership" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">calculate_days_and_daily_ridership</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Task to calculate number of days in the month and daily ridership.</p>

          <details class="quote">
            <summary>Source code in <code>prefect_transitscope_baltimore_pipeline/tasks.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">calculate_days_and_daily_ridership</span><span class="p">(</span><span class="n">bus_ridership_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Task to calculate number of days in the month and daily ridership.&quot;&quot;&quot;</span>
    <span class="n">bus_ridership_data</span><span class="p">[</span><span class="s2">&quot;days_in_month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bus_ridership_data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="n">calculate_days_in_month</span>
    <span class="p">)</span>
    <span class="n">bus_ridership_data</span><span class="p">[</span><span class="s2">&quot;daily_ridership&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bus_ridership_data</span><span class="p">[</span><span class="s2">&quot;ridership&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">bus_ridership_data</span><span class="p">[</span><span class="s2">&quot;days_in_month&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">bus_ridership_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prefect_transitscope_baltimore_pipeline.tasks.calculate_days_in_month" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">calculate_days_in_month</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate the number of days in a given month.</p>

          <details class="quote">
            <summary>Source code in <code>prefect_transitscope_baltimore_pipeline/tasks.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_days_in_month</span><span class="p">(</span><span class="n">date_value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the number of days in a given month.&quot;&quot;&quot;</span>
    <span class="n">last_day_of_month</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span>
        <span class="n">date_value</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
        <span class="n">date_value</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
        <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">date_value</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">date_value</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">last_day_of_month</span><span class="o">.</span><span class="n">day</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prefect_transitscope_baltimore_pipeline.tasks.convert_date_and_calculate_end_of_month" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">convert_date_and_calculate_end_of_month</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Task to convert date column to datetime format and calculate end date of month.</p>

          <details class="quote">
            <summary>Source code in <code>prefect_transitscope_baltimore_pipeline/tasks.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">convert_date_and_calculate_end_of_month</span><span class="p">(</span><span class="n">bus_ridership_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Task to convert date column to datetime format and calculate end date of month.&quot;&quot;&quot;</span>
    <span class="n">bus_ridership_data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
        <span class="n">bus_ridership_data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%m/%Y&quot;</span>
    <span class="p">)</span>
    <span class="n">bus_ridership_data</span><span class="p">[</span><span class="s2">&quot;end_of_month_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bus_ridership_data</span><span class="p">[</span>
        <span class="s2">&quot;date&quot;</span>
    <span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bus_ridership_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prefect_transitscope_baltimore_pipeline.tasks.download_mta_bus_stops" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_mta_bus_stops</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Downloads and processes data for MTA bus stops in Maryland.</p>
<p>This function retrieves the metadata from the Maryland Transit FeatureServer,
extracting the description of the data. It then downloads the MTA bus stops data
in GeoJSON format, standardizes the column names, adds a description from the metadata,
and appends the current download date and time to each record.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>GeoDataFrame</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A GeoDataFrame containing the MTA bus stops data with standardized</p>
            </div>
          </td>
        </tr>
        <tr>
<td></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>column names, the data source description, and the download date and time.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>prefect_transitscope_baltimore_pipeline/tasks.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">download_mta_bus_stops</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Downloads and processes data for MTA bus stops in Maryland.</span>

<span class="sd">    This function retrieves the metadata from the Maryland Transit FeatureServer,</span>
<span class="sd">    extracting the description of the data. It then downloads the MTA bus stops data</span>
<span class="sd">    in GeoJSON format, standardizes the column names, adds a description from the metadata,</span>
<span class="sd">    and appends the current download date and time to each record.</span>

<span class="sd">    Returns:</span>
<span class="sd">        GeoDataFrame: A GeoDataFrame containing the MTA bus stops data with standardized</span>
<span class="sd">        column names, the data source description, and the download date and time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metadata_url</span> <span class="o">=</span> <span class="s2">&quot;https://geodata.md.gov/imap/rest/services/Transportation/MD_Transit/FeatureServer/9?f=pjson&quot;</span>
    <span class="n">metadata_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metadata_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">metadata_response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">metadata_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;No description available&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Description from Metadata:&quot;</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve metadata&quot;</span><span class="p">)</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;No description available&quot;</span>

    <span class="n">stops</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span>
        <span class="s2">&quot;https://geodata.md.gov/imap/rest/services/Transportation/MD_Transit/FeatureServer/9/query?where=1%3D1&amp;outFields=*&amp;outSR=4326&amp;f=geojson&quot;</span>
    <span class="p">)</span>
    <span class="n">stops</span> <span class="o">=</span> <span class="n">standardize_column_names</span><span class="p">(</span><span class="n">stops</span><span class="p">)</span>
    <span class="n">stops</span><span class="p">[</span><span class="s2">&quot;data_source_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span>
    <span class="n">stops</span><span class="p">[</span><span class="s2">&quot;download_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">stops</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prefect_transitscope_baltimore_pipeline.tasks.exclude_zero_ridership" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">exclude_zero_ridership</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Task to exclude rows with zero ridership.</p>

          <details class="quote">
            <summary>Source code in <code>prefect_transitscope_baltimore_pipeline/tasks.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">exclude_zero_ridership</span><span class="p">(</span><span class="n">bus_ridership_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Task to exclude rows with zero ridership.&quot;&quot;&quot;</span>
    <span class="n">bus_ridership_data</span> <span class="o">=</span> <span class="n">bus_ridership_data</span><span class="p">[</span>
        <span class="n">bus_ridership_data</span><span class="p">[</span><span class="s2">&quot;ridership&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">bus_ridership_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prefect_transitscope_baltimore_pipeline.tasks.format_bus_routes" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">format_bus_routes</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Format bus route strings, capitalizing CityLink routes.</p>

          <details class="quote">
            <summary>Source code in <code>prefect_transitscope_baltimore_pipeline/tasks.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_bus_routes</span><span class="p">(</span><span class="n">bus_routes_str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format bus route strings, capitalizing CityLink routes.&quot;&quot;&quot;</span>
    <span class="n">citylink_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;CityLink ([A-Z]+)&quot;</span><span class="p">)</span>
    <span class="n">formatted_routes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">citylink_pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="s2">&quot;CityLink &quot;</span> <span class="o">+</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
            <span class="n">route</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">bus_routes_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted_routes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prefect_transitscope_baltimore_pipeline.tasks.format_bus_routes_task" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">format_bus_routes_task</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Task to format bus route strings, capitalizing CityLink routes.</p>

          <details class="quote">
            <summary>Source code in <code>prefect_transitscope_baltimore_pipeline/tasks.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">format_bus_routes_task</span><span class="p">(</span><span class="n">bus_ridership_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Task to format bus route strings, capitalizing CityLink routes.&quot;&quot;&quot;</span>
    <span class="n">bus_ridership_data</span><span class="p">[</span><span class="s2">&quot;route&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bus_ridership_data</span><span class="p">[</span><span class="s2">&quot;route&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="n">format_bus_routes</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">bus_ridership_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prefect_transitscope_baltimore_pipeline.tasks.map_color_to_citylink" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">map_color_to_citylink</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The function <code>map_color_to_citylink</code> maps a color to a corresponding citylink or returns the color
itself if no mapping is found.</p>
<p>:param color: The color parameter is a string representing a color
:return: the value associated with the given color in the <code>color_to_citylink</code> dictionary. If the
color is not found in the dictionary, it will return the color itself.</p>

          <details class="quote">
            <summary>Source code in <code>prefect_transitscope_baltimore_pipeline/tasks.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">map_color_to_citylink</span><span class="p">(</span><span class="n">color</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The function `map_color_to_citylink` maps a color to a corresponding citylink or returns the color</span>
<span class="sd">    itself if no mapping is found.</span>

<span class="sd">    :param color: The color parameter is a string representing a color</span>
<span class="sd">    :return: the value associated with the given color in the `color_to_citylink` dictionary. If the</span>
<span class="sd">    color is not found in the dictionary, it will return the color itself.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">color_to_citylink</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prefect_transitscope_baltimore_pipeline.tasks.scrape" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">scrape</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Scrape data from the MTA Maryland Performance Improvement website and return it as a pandas DataFrame.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pandas.DataFrame: The scraped data as a DataFrame with columns: 'Date', 'Route', and 'Ridership'.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="k">await</span> <span class="n">scrape</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">     Date  Route  Ridership</span>
<span class="go">0  01/2023    103       3916</span>
<span class="go">1  01/2023    105       3530</span>
<span class="go">2  01/2023    115       4179</span>
<span class="go">3  01/2023    120       3887</span>
<span class="go">4  01/2023    150       1833</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>prefect_transitscope_baltimore_pipeline/tasks.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@task</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">scrape</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scrape data from the MTA Maryland Performance Improvement website and return it as a pandas DataFrame.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pandas.DataFrame: The scraped data as a DataFrame with columns: &#39;Date&#39;, &#39;Route&#39;, and &#39;Ridership&#39;.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; df = await scrape()</span>
<span class="sd">        &gt;&gt;&gt; print(df.head())</span>
<span class="sd">             Date  Route  Ridership</span>
<span class="sd">        0  01/2023    103       3916</span>
<span class="sd">        1  01/2023    105       3530</span>
<span class="sd">        2  01/2023    115       4179</span>
<span class="sd">        3  01/2023    120       3887</span>
<span class="sd">        4  01/2023    150       1833</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Launching the browser and setting up a new page</span>
    <span class="n">browser</span> <span class="o">=</span> <span class="k">await</span> <span class="n">launch</span><span class="p">(</span>
        <span class="n">handleSIGINT</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">handleSIGTERM</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">handleSIGHUP</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="n">browser</span><span class="o">.</span><span class="n">newPage</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">setViewport</span><span class="p">({</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">1920</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mi">1080</span><span class="p">})</span>
    <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="s2">&quot;https://www.mta.maryland.gov/performance-improvement&quot;</span><span class="p">)</span>

    <span class="c1"># Interacting with elements on the page</span>
    <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="s2">&quot;h3#ui-id-5&quot;</span><span class="p">)</span>
    <span class="n">csvString</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Selecting and processing data from dropdown options</span>
    <span class="n">routeSelectSelector</span> <span class="o">=</span> <span class="s1">&#39;select[name=&quot;ridership-select-route&quot;]&#39;</span>
    <span class="n">routeSelectOptions</span> <span class="o">=</span> <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;() =&gt; Array.from(document.querySelectorAll(&#39;select[name=&quot;ridership-select-route&quot;] option&#39;)).map(option =&gt; option.value)&quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Route select options: </span><span class="si">{</span><span class="n">routeSelectOptions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">monthSelectSelector</span> <span class="o">=</span> <span class="s1">&#39;select[name=&quot;ridership-select-month&quot;]&#39;</span>
    <span class="n">monthSelectOptions</span> <span class="o">=</span> <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;() =&gt; Array.from(document.querySelectorAll(&#39;select[name=&quot;ridership-select-month&quot;] option&#39;)).map(option =&gt; option.value)&quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Month select options: </span><span class="si">{</span><span class="n">monthSelectOptions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">yearSelectSelector</span> <span class="o">=</span> <span class="s1">&#39;select[name=&quot;ridership-select-year&quot;]&#39;</span>
    <span class="n">yearSelectOptions</span> <span class="o">=</span> <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;() =&gt; Array.from(document.querySelectorAll(&#39;select[name=&quot;ridership-select-year&quot;] option&#39;)).map(option =&gt; option.value)&quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Year select options: </span><span class="si">{</span><span class="n">yearSelectOptions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Now, we need to click on the &#39;submit&#39; button to get the data</span>
    <span class="c1"># example: &lt;button class=&quot;btn btn-default btn-submit btn-ridership&quot; type=&quot;submit&quot; name=&quot;submit&quot;&gt;Submit&lt;/button&gt;</span>
    <span class="c1"># await page.click(&#39;button.btn.btn-default.btn-submit.btn-ridership&#39;)</span>

    <span class="c1"># Looping through options to generate CSV data</span>
    <span class="n">hasIncludedRowHeaders</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">yearSelectOption</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
        <span class="n">yearSelectOptions</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Years&quot;</span>
    <span class="p">):</span>
        <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">focus</span><span class="p">(</span><span class="n">yearSelectSelector</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">yearSelectSelector</span><span class="p">,</span> <span class="n">yearSelectOption</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">monthSelectOption</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
            <span class="n">monthSelectOptions</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Months&quot;</span>
        <span class="p">):</span>
            <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">focus</span><span class="p">(</span><span class="n">monthSelectSelector</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">monthSelectSelector</span><span class="p">,</span> <span class="n">monthSelectOption</span><span class="p">)</span>
            <span class="c1"># Printing the selected option</span>
            <span class="c1"># tqdm.write(f&quot;Selected month: {monthSelectOption}&quot;)</span>
            <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">keyboard</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="s2">&quot;Tab&quot;</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">keyboard</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="s2">&quot;Tab&quot;</span><span class="p">)</span>

            <span class="c1"># Waiting for network responses after form submission</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                <span class="c1"># page.keyboard.press(&#39;Enter&#39;),</span>
                <span class="n">page</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="s2">&quot;button.btn.btn-default.btn-submit.btn-ridership&quot;</span><span class="p">),</span>
                <span class="c1"># Wait for 1 second after clicking the button</span>
                <span class="n">page</span><span class="o">.</span><span class="n">waitFor</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
                <span class="c1"># page.waitForNavigation(),</span>
                <span class="c1"># page.waitForNavigation({&#39;waitUntil&#39;: &#39;networkidle2&#39;, &#39;timeout&#39;: 30000})s</span>
            <span class="p">)</span>
            <span class="c1"># navigationPromise = async.ensure_future(page.waitForNavigation())</span>
            <span class="c1"># await page.click(&#39;a.my-link&#39;)  # indirectly cause a navigation</span>
            <span class="c1"># await navigationPromise  # wait until navigation finishes</span>
            <span class="c1"># Concatenating CSV string for each selection</span>
            <span class="n">csvString</span> <span class="o">+=</span> <span class="k">await</span> <span class="n">computeCsvStringFromTable</span><span class="p">(</span>
                <span class="n">page</span><span class="p">,</span>
                <span class="s2">&quot;div#container-ridership-table &gt; table&quot;</span><span class="p">,</span>
                <span class="n">hasIncludedRowHeaders</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">hasIncludedRowHeaders</span><span class="p">:</span>
                <span class="n">hasIncludedRowHeaders</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Closing the browser</span>
    <span class="k">await</span> <span class="n">browser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Converting the CSV string to a pandas dataframe</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">csvString</span><span class="p">))</span>

    <span class="c1"># Writing the CSV string to a file</span>
    <span class="c1"># with open(&quot;mta_bus_ridership.csv&quot;, &quot;w&quot;) as file:</span>
    <span class="c1">#     file.write(csvString)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prefect_transitscope_baltimore_pipeline.tasks.standardize_column_names" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">standardize_column_names</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Standardize DataFrame column names to lowercase with underscores.</p>

          <details class="quote">
            <summary>Source code in <code>prefect_transitscope_baltimore_pipeline/tasks.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">standardize_column_names</span><span class="p">(</span><span class="n">data_frame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Standardize DataFrame column names to lowercase with underscores.&quot;&quot;&quot;</span>
    <span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">data_frame</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prefect_transitscope_baltimore_pipeline.tasks.standardize_column_names_task" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">standardize_column_names_task</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Task to standardize DataFrame column names to lowercase with underscores.</p>

          <details class="quote">
            <summary>Source code in <code>prefect_transitscope_baltimore_pipeline/tasks.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">standardize_column_names_task</span><span class="p">(</span><span class="n">data_frame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Task to standardize DataFrame column names to lowercase with underscores.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">standardize_column_names</span><span class="p">(</span><span class="n">data_frame</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prefect_transitscope_baltimore_pipeline.tasks.transform_mta_bus_stops" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform_mta_bus_stops</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Transforms a GeoDataFrame containing MTA bus stops data.</p>
<p>This function performs several transformations on the MTA bus stops data:</p>
<ul>
<li>Extracts latitude and longitude from the 'geometry' field.</li>
<li>Processes the 'routes_served' field to standardize route information. This involves splitting the routes on commas and semicolons, mapping each route to a color using the 'map_color_to_citylink' function, and consolidating routes served per stop.</li>
<li>Rearranges the columns, placing 'routes_served' into a specific position.</li>
</ul>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>gdf</code></td>
          <td>
                <code>GeoDataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A GeoDataFrame containing MTA bus stops data with fields including 'geometry' and 'routes_served'.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>GeoDataFrame</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The transformed GeoDataFrame with additional latitude and longitude fields, and a modified 'routes_served' field reflecting individual routes served per bus stop.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>prefect_transitscope_baltimore_pipeline/tasks.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">transform_mta_bus_stops</span><span class="p">(</span><span class="n">gdf</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms a GeoDataFrame containing MTA bus stops data.</span>

<span class="sd">    This function performs several transformations on the MTA bus stops data:</span>

<span class="sd">    - Extracts latitude and longitude from the &#39;geometry&#39; field.</span>
<span class="sd">    - Processes the &#39;routes_served&#39; field to standardize route information. This involves splitting the routes on commas and semicolons, mapping each route to a color using the &#39;map_color_to_citylink&#39; function, and consolidating routes served per stop.</span>
<span class="sd">    - Rearranges the columns, placing &#39;routes_served&#39; into a specific position.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        gdf (GeoDataFrame): A GeoDataFrame containing MTA bus stops data with fields including &#39;geometry&#39; and &#39;routes_served&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        GeoDataFrame: The transformed GeoDataFrame with additional latitude and longitude fields, and a modified &#39;routes_served&#39; field reflecting individual routes served per bus stop.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Any exceptions raised by the function are not explicitly mentioned in the docstring.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">y</span>
    <span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span>
    <span class="n">route_stop</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[[</span><span class="s2">&quot;stop_id&quot;</span><span class="p">,</span> <span class="s2">&quot;routes_served&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># We need to split on commas and semicolons</span>
    <span class="n">route_stop</span><span class="p">[</span><span class="s2">&quot;routes_served&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">route_stop</span><span class="p">[</span><span class="s2">&quot;routes_served&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">route_stop</span> <span class="o">=</span> <span class="n">route_stop</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;routes_served&quot;</span><span class="p">)</span>
    <span class="c1"># Split on semicolons</span>
    <span class="n">route_stop</span><span class="p">[</span><span class="s2">&quot;routes_served&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">route_stop</span><span class="p">[</span><span class="s2">&quot;routes_served&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
    <span class="n">route_stop</span> <span class="o">=</span> <span class="n">route_stop</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;routes_served&quot;</span><span class="p">)</span>
    <span class="n">route_stop</span><span class="p">[</span><span class="s2">&quot;routes_served&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">route_stop</span><span class="p">[</span><span class="s2">&quot;routes_served&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="c1"># Apply the function to the &#39;routes_served&#39; column</span>
    <span class="n">route_stop</span><span class="p">[</span><span class="s2">&quot;routes_served&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">route_stop</span><span class="p">[</span><span class="s2">&quot;routes_served&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="n">map_color_to_citylink</span>
    <span class="p">)</span>
    <span class="c1"># Re-join the routes served by stop into a df with one row per stop: route_stop, routes_served</span>
    <span class="n">route_stop</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">route_stop</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;stop_id&quot;</span><span class="p">)[</span><span class="s2">&quot;routes_served&quot;</span><span class="p">]</span>
        <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="c1"># Remove the brackets from the list of routes served</span>
    <span class="n">route_stop</span><span class="p">[</span><span class="s2">&quot;routes_served&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">route_stop</span><span class="p">[</span><span class="s2">&quot;routes_served&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[]&quot;</span><span class="p">)</span>
    <span class="c1"># Drop routes_served from the original gdf</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;routes_served&quot;</span><span class="p">])</span>
    <span class="c1"># Merge the routes served by stop back into the original gdf</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">route_stop</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;stop_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="c1"># Shift routes_served to position 6</span>
    <span class="n">gdf</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;routes_served&quot;</span><span class="p">,</span> <span class="n">gdf</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;routes_served&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">gdf</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>